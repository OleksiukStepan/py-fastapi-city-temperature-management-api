
# City Temperature Management API

A FastAPI-based application for managing city temperature data, fetching real-time temperature updates using the OpenWeather API, and performing CRUD operations on city data. The project uses PostgreSQL for data storage, pgAdmin for database administration, and Alembic for database migrations.

## Table of Contents
1. [Getting Started](#getting-started)
2. [Instructions to Run the Application](#instructions-to-run-the-application)
3. [Project Structure and Design Choices](#project-structure-and-design-choices)
4. [Assumptions and Simplifications](#assumptions-and-simplifications)
5. [Environment Variables](#environment-variables)
6. [Seeding the Database](#seeding-the-database)

---

## Getting Started

### Prerequisites

- **Docker**: Ensure Docker is installed and running on your machine.
- **Python (optional)**: Only if running locally outside of Docker.

Clone the repository and navigate to the project directory:

```bash
git clone <repository-url>
cd py-fastapi-city-temperature-management-api
```

### Environment Variables

Copy the sample environment variables into a `.env` file in the project root. These variables include PostgreSQL credentials, OpenWeather API key, and pgAdmin details.

## Instructions to Run the Application

1. **Build and Start Services with Docker Compose**:

   ```bash
   docker-compose up --build
   ```

   This command will:
   - Set up a PostgreSQL database
   - Start the FastAPI application server on `http://localhost:8000`.
   - Run Alembic migrations to initialize the database schema.


2. **API Documentation**:

   - Visit `http://localhost:8000/docs` for interactive API documentation generated by FastAPI.


## Project Structure and Design Choices

- **Async CRUD Operations**: The project uses async functions with SQLAlchemyâ€™s `AsyncSession` to improve performance when handling database requests.
- **Environment Configuration**: Configured via Pydantic, using a `.env` file to manage secrets and environment variables securely.
- **Dockerized Architecture**: Docker Compose is used to define and manage multiple services (database, API server, pgAdmin) for an isolated, reproducible environment.

## Assumptions and Simplifications

- **Limited Error Handling**: Only essential error handling has been implemented. Future improvements could include more detailed error responses.
- **Simplified Data Model**: The data model only covers city and temperature data. More fields could be added for expanded functionality.
- **API Key Management**: Assumes an OpenWeather API key will be available in the environment.

## Environment Variables

### Sample `.env`

Refer to the `.env_sample` file for a template of required environment variables.

## Seeding the Database

To load initial data into the database, use the `seed` command in the command-line interface (CLI) provided by `Typer`.

### Steps

1. **Ensure Prerequisites**: Make sure all services are running (you can start them with `docker-compose up --build`).

2. **Run the Seed Command**:

   ```bash
   ./manage.py
   ```

   This command will:
   - Connect to the database.
   - Check if there is already data in the `cities` table.
   - Insert initial cities if there are less than 8 entries.


3. **Confirm Data**:
   - You can confirm that the data was inserted by checking the database directly or using any of the available API endpoints to retrieve cities.

